version: "3.8"
services:
  scheduler:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DECIPHON_SCHEDULER_S3_URL=http://minio:9000
      - DECIPHON_SCHEDULER_MQTT_HOST=mosquitto
      - DECIPHON_SCHEDULER_MQTT_PORT=1883
    depends_on:
      - minio
      - mosquitto
    command:
      [
        "uvicorn",
        "--factory",
        "deciphon_scheduler.main:create_app",
        "--host",
        "0.0.0.0",
        "--port",
        "8000"
      ]
  minio:
    image: "quay.io/minio/minio"
    ports:
      - "9000:9000"
      - "9001:9001"
    command: [ "server", "/data", "--console-address", ":9001" ]
  mosquitto:
    image: "eclipse-mosquitto"
    ports:
      - "1883:1883"
    command: [ "mosquitto", "-c", "/mosquitto-no-auth.conf" ]
